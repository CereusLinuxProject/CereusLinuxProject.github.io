<!--BANNER-->
<link rel="stylesheet" href="/css/updates.css">

<section class="header-upt">
	<div class="weltext">
		<p id="str-extrasubtitle">This page contains last 15 commits in Cereus Linux codeberg organization</p>
		<h1>Recent Commits</h1>
	</div>
</section>
<br>

<div id="commit-feed"></div>


<script>
async function fetchCommits(url) {
	try {
		const response = await fetch(url);
		const data = await response.json();
		const container = document.getElementById("commit-feed");

		data
			.filter(entry => entry.op_type === "commit_repo")
			.slice(0, 15)
			.forEach(entry => {
				const user = entry.act_user;
				const repo = entry.repo;
				let content = null;
				let commits = [];

				try {
					content = JSON.parse(entry.content);
					if (content && Array.isArray(content.Commits)) {
						commits = content.Commits;
					}
				} catch (e) {
					console.warn("Invalid JSON in content:", entry.content);
					return;
				}

				commits.forEach(commit => {
					const commitUrl = `https://codeberg.org/${repo.full_name}/commit/${commit.Sha1}`;
					const message = commit.Message || "";

					// Always use the first line as title
					const [rawTitle, ...rest] = message.split(/\r?\n+/);
					const title = rawTitle.trim();
					const body = rest.length > 0 ? rest[0].trim() : "";

					const table = document.createElement("table");
					table.className = "commit-table";

					table.innerHTML = `
						<tr>
							<td>
								<img src="${user.avatar_url}" alt="avatar" />
								<h3>
									<a href="${user.html_url}" target="_blank">
										${user.full_name || user.login}
									</a>
								</h3>
							</td>
							<td>
								<h2>${repo.full_name}</h2>
								<hr />
								<h4>
									<a href="${commitUrl}" class="commit-title" target="_blank">
										${title}
									</a>
								</h4>
								${body ? `<p>${body}</p>` : ""}
								<div>
									<a href="${commitUrl}" class="commit-date-button" target="_blank">
										${new Date(commit.Timestamp || entry.created).toLocaleString()}
									</a>
								</div>
							</td>
						</tr>
					`;
					container.appendChild(table);
				});
			});
	} catch (error) {
		console.error("Error fetching commits:", error);
	}
}

fetchCommits("https://codeberg.org/api/v1/orgs/cereus-linux/activities/feeds");
</script>

